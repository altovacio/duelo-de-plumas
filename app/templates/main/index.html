{% extends "base.html" %}
{# Import the macro from the new contests page template #}
{% from "main/contests.html" import contest_list with context %}

{% block title %}Inicio - Duelo de Plumas{% endblock %}

{% block content %}
    <div class="contests-container"> {# Added container similar to contests.html #}
        <section class="hero">
            <h1>Bienvenido a Duelo de Plumas</h1>
            <p>La plataforma para concursos literarios.</p>
            <!-- Add more introductory content or imagery here -->
        </section>

        {# Judge's Pending Evaluations Section #}
        {% if current_user.is_authenticated and current_user.role == 'judge' and judge_assigned_evaluations %}
            <div class="judge-evaluation-section">
                <h3 class="section-title">Mis Evaluaciones Pendientes</h3>
                <ul class="contest-list">
                    {% for contest in judge_assigned_evaluations %}
                        <li class="contest-item {% if contest.contest_type == 'private' %}private-contest{% endif %}">
                            <div class="contest-header">
                                <h4 class="contest-title">
                                    <a href="{{ url_for('contest.list_submissions', contest_id=contest.id) }}">{{ contest.title }}</a>
                                    {% if contest.contest_type == 'private' %}<span class="private-badge">Privado</span>{% endif %}
                                </h4>
                            </div>
                             <div class="contest-meta">
                                <span class="meta-date">⏰ Evaluación requerida (Finalizó: {{ contest.end_date.strftime('%d/%m/%Y') }})</span>
                            </div>
                            {# Add link to evaluation page #}
                            <a href="{{ url_for('contest.evaluate_contest', contest_id=contest.id) }}" class="button button-small">Evaluar Ahora</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <hr class="section-divider">
        {% endif %}

        {# Admin section for pending AI evaluations #}
        {% if current_user.is_authenticated and current_user.is_admin() and pending_ai_evaluations %}
            <section class="contest-section ai-pending">
                <h3 class="section-title"><i class="fas fa-robot"></i> Evaluaciones de IA Pendientes</h3>
                <ul class="contest-list">
                    {% for contest in pending_ai_evaluations %}
                        <li class="contest-item {% if contest.contest_type == 'private' %}private-contest{% endif %}">
                            <div class="contest-header">
                                <h4 class="contest-title">
                                    <a href="{{ url_for('contest.list_submissions', contest_id=contest.id) }}">{{ contest.title }}</a>
                                    {% if contest.contest_type == 'private' %}<span class="private-badge">Privado</span>{% endif %}
                                </h4>
                            </div>
                            <div class="contest-meta">
                                <span class="meta-date">Estado: {{ contest.status }} | Fin: {{ contest.end_date.strftime('%d/%m/%Y') }}</span>
                            </div>
                            <a href="{{ url_for('contest.list_submissions', contest_id=contest.id) }}" class="button button-small button-ai">Ejecutar Evaluación de IA</a>
                        </li>
                    {% endfor %}
                </ul>
            </section>
            <style>
                .ai-pending h3 {
                    color: #8e44ad;
                }
                .ai-pending h3 i {
                    margin-right: 8px;
                }
                .button-ai {
                    background-color: #8e44ad;
                    color: white;
                }
                .button-ai:hover {
                    background-color: #9b59b6;
                }
            </style>
            <hr class="section-divider">
        {% endif %}

        {# Use the macro for active contests #}
        {{ contest_list(active_contests, 'Concursos Abiertos') }}

        <hr class="section-divider">

        {# Use the macro for recently closed contests #}
        {# Note: The route currently fetches all closed contests, but the macro handles displaying results only for public ones #}
        {# We pass only the first 3 closed contests for brevity on the index page #}
        {{ contest_list(closed_contests[:3], 'Concursos Recién Finalizados') }}
        
        {# Link to the main contests page if there are more closed contests than shown #}
        {% if closed_contests|length > 3 %}
            <p style="text-align: right;"><a href="{{ url_for('main.list_contests') }}">Ver todos los concursos finalizados...</a></p>
        {% endif %}
    
    </div> {# End contests-container #}
{% endblock %} 