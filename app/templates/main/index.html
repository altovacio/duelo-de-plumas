{% extends "base.html" %}
{# Import the macro from the new contests page template #}
{% from "main/contests.html" import contest_list with context %}

{% block title %}Inicio - Duelo de Plumas{% endblock %}

{% block content %}
    <div class="contests-container"> {# Added container similar to contests.html #}
        <section class="hero">
            <h1>Duelo <br> de <br> Plumas</h1>
        </section>
        
        <div class="hero-subtitle">
            <p>Humanos e Inteligencia Artificial en competencia literaria.</p>
        </div>

        {# Judge's Pending Evaluations Section #}
        {% if current_user.is_authenticated and current_user.role == 'judge' and judge_assigned_evaluations %}
            <div class="judge-evaluation-section">
                <h3 class="section-title">Mis Evaluaciones Pendientes</h3>
                <ul class="contest-list">
                    {% for contest in judge_assigned_evaluations %}
                        <li class="contest-item {% if contest.contest_type == 'private' %}private-contest{% endif %}">
                            <div class="contest-header">
                                <h4 class="contest-title">
                                    <a href="{{ url_for('contest.list_submissions', contest_id=contest.id) }}">{{ contest.title }}</a>
                                    {% if contest.contest_type == 'private' %}<span class="private-badge">Privado</span>{% endif %}
                                </h4>
                            </div>
                            
                            <div class="contest-description">
                                {% if contest.description %}
                                    {{ contest.description|truncate(150) }}
                                {% else %}
                                    <em>No hay descripción disponible para este concurso.</em>
                                {% endif %}
                            </div>
                             
                            <div class="contest-meta">
                                <span class="meta-date">⏰ Evaluación requerida (Finalizó: {{ contest.end_date|human_date }})</span>
                                
                                <div class="meta-stats">
                                    <span class="meta-stat">
                                        <i class="fas fa-users"></i> {{ contest.submissions.count() }} participantes
                                    </span>
                                    {% if contest.word_limit %}
                                    <span class="meta-stat">
                                        <i class="fas fa-align-left"></i> Límite: {{ contest.word_limit }} palabras
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            {# Add link to evaluation page #}
                            <a href="{{ url_for('contest.evaluate_contest', contest_id=contest.id) }}" class="button button-small">Evaluar Ahora</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <hr class="section-divider">
        {% endif %}

        {# Admin section for pending AI evaluations #}
        {% if current_user.is_authenticated and current_user.is_admin() and pending_ai_evaluations %}
            <section class="contest-section ai-pending">
                <h3 class="section-title"><i class="fas fa-robot"></i> Evaluaciones de IA Pendientes</h3>
                <ul class="contest-list">
                    {% for contest in pending_ai_evaluations %}
                        <li class="contest-item {% if contest.contest_type == 'private' %}private-contest{% endif %}">
                            <div class="contest-header">
                                <h4 class="contest-title">
                                    <a href="{{ url_for('contest.list_submissions', contest_id=contest.id) }}">{{ contest.title }}</a>
                                    {% if contest.contest_type == 'private' %}<span class="private-badge">Privado</span>{% endif %}
                                </h4>
                            </div>
                            
                            <div class="contest-description">
                                {% if contest.description %}
                                    {{ contest.description|truncate(150) }}
                                {% else %}
                                    <em>No hay descripción disponible para este concurso.</em>
                                {% endif %}
                            </div>
                            
                            <div class="contest-meta">
                                <span class="meta-date">Estado: {{ contest.status }} | Fin: {{ contest.end_date|human_date }}</span>
                                
                                <div class="meta-stats">
                                    <span class="meta-stat">
                                        <i class="fas fa-users"></i> {{ contest.submissions.count() }} participantes
                                    </span>
                                    {% if contest.word_limit %}
                                    <span class="meta-stat">
                                        <i class="fas fa-align-left"></i> Límite: {{ contest.word_limit }} palabras
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <a href="{{ url_for('contest.list_submissions', contest_id=contest.id) }}" class="button button-small button-ai">Ejecutar Evaluación de IA</a>
                        </li>
                    {% endfor %}
                </ul>
            </section>
            <hr class="section-divider">
        {% endif %}

        {# Use the macro for active contests #}
        {{ contest_list(active_contests, 'Concursos Abiertos') }}

        <hr class="section-divider">

        {# Use the macro for recently closed contests #}
        {{ contest_list(closed_contests[:3], 'Concursos Finalizados Recientemente') }}
        
        {# Link to the main contests page if there are more closed contests than shown #}
        {% if closed_contests|length > 3 %}
            <p style="text-align: right;"><a href="{{ url_for('main.list_contests') }}" class="button button-small">Ver todos los concursos finalizados</a></p>
        {% endif %}
    
    </div> {# End contests-container #}
{% endblock %} 